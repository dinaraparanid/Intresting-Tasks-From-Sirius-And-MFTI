/*–ú–∞–ª–µ–Ω—å–∫–∞—è –¥–µ–≤–æ—á–∫–∞ –õ–∏–∑–∞ –Ω–∞—à–ª–∞ —Å—Ç—Ä–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç –¥–ª—è —Å—á–µ—Ç–∞. –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∫–ª–µ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ
—Å–æ–µ–¥–∏–Ω–µ–Ω—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º –ø—Ä–æ–≤–æ–¥–∫–∞–º–∏, –∫–æ–Ω—Ü—ã –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–º–µ—á–µ–Ω—ã —Å–∏–º–≤–æ–ª–∞–º–∏ ÙÄÄÄ –∏ +. –í –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–µ
–∞–≤—Ç–æ–º–∞—Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ –ª–∏–±–æ —á–∏—Å–ª–æ, –ª–∏–±–æ –æ–ø–µ—Ä–∞—Ü–∏—è, –ª–∏–±–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è. –í –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫ –∞–≤—Ç–æ–º–∞—Ç—É –æ–Ω–∞
–ø—Ä–æ—á–∏—Ç–∞–ª–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ –ø—Ä–æ–≤–æ–¥–∫–∞–º –æ—Ç –∫–ª–µ—Ç–∫–∏ —Å –º–∏–Ω—É—Å–æ–º –∫ –∫–ª–µ—Ç–∫–µ —Å –ø–ª—é—Å–æ–º. –í —ç—Ç–æ–º
—Å–ª—É—á–∞–µ –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ –∫–ª–µ—Ç–∫–∞ —Å –ø–ª—é—Å–æ–º –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–ª–µ—Ç–∫–∏ —Å –º–∏–Ω—É—Å–æ–º.
–†–∞–±–æ—Ç–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ –∫–ª–µ—Ç–∫–µ, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ø–æ–º–µ—á–µ–Ω–∞ –Ω–∏ –æ–¥–Ω–∏–º –ø–ª—é—Å–æ–º, —è–≤–ª—è–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ,
–∑–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ –Ω–µ—ë;
 –¥–ª—è –≤—Å–µ—Ö –∫–ª–µ—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–ª–µ—Ç–∫–∞—Ö, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–≤–∏—Å–∏—Ç
—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —ç—Ç–æ–π –∫–ª–µ—Ç–∫–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è
–≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö;
 —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –≤ –∫–ª–µ—Ç–∫–µ —Å –Ω–æ–º–µ—Ä–æ–º 1, —è–≤–ª—è–µ—Ç—Å—è –∏—Ç–æ–≥–æ–≤—ã–º.
–ï—Å–ª–∏ –≤ –∫–ª–µ—Ç–∫–µ –∑–∞–ø–∏—Å–∞–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–µ –º–µ–Ω–µ–µ
–¥–≤—É—Ö –¥—Ä—É–≥–∏—Ö –∫–ª–µ—Ç–æ–∫. –ï—Å–ª–∏ –≤ –∫–ª–µ—Ç–∫–µ –∑–∞–ø–∏—Å–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏–ª–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, —Ç–æ –æ–Ω–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ-
–∑—É–ª—å—Ç–∞—Ç–∞ –¥—Ä—É–≥–∏—Ö –∫–ª–µ—Ç–æ–∫. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –∫–ª–µ—Ç–∫–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –¥–ª—è
–ª—é–±–æ–π –∫–ª–µ—Ç–∫–∏ —Å —É–º–Ω–æ–∂–µ–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ –∫–ª–µ—Ç–∫–∏ —Å –ø–µ—Ä–µ–º–µ–Ω-
–Ω–æ–π. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
–õ–∏–∑–∞ —Ä–µ—à–∏–ª–∞ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—è. –î–ª—è —ç—Ç–æ–≥–æ –æ–Ω–∞ –Ω–∞–ø–∏—Å–∞–ª–∞ –Ω–∞–±–æ—Ä
—á–∏—Å–µ–ª ‚Äî –∑–Ω–∞—á–µ–Ω–∏–π x. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –æ–Ω–∞ —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–Ω–æ
–≤—ã–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ. –ü–æ–º–æ–≥–∏—Ç–µ –µ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π.
–§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–í –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∑–∞–ø–∏—Å–∞–Ω—ã —Ç—Ä–∏ —á–∏—Å–ª–∞ N, M, –∏ Q ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–µ—Ç–æ–∫, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (1 ‚©Ω N;M;Q ‚©Ω 105).
–í–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–µ –∑–∞–ø–∏—Å–∞–Ω—ã N –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–æ—Ä—è–¥–∫–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –Ω–æ–º–µ—Ä–∞–º –∫–ª–µ—Ç–æ–∫, –≤ –∫–æ—Ç–æ-
—Ä—ã—Ö —ç—Ç–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∑–∞–ø–∏—Å–∞–Ω—ã:
 + –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–ª–µ—Ç–∫–µ —Ä–∞–≤–µ–Ω —Å—É–º–º–µ –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö —ç—Ç–∞
–∫–ª–µ—Ç–∫–∞ –∑–∞–≤–∏—Å–∏—Ç;
  –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–ª–µ—Ç–∫–µ —Ä–∞–≤–µ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–ª–µ—Ç–∫–∞—Ö,
–æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –¥–∞–Ω–Ω–∞—è –∫–ª–µ—Ç–∫–∞ –∑–∞–≤–∏—Å–∏—Ç;
 x –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –¥–∞–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è;
 val –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–ª–µ—Ç–∫–µ –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ val (1 ‚©Ω val ‚©Ω 109 + 8).
–í —Å–ª–µ–¥—É—é—â–∏—Ö M —Å—Ç—Ä–æ–∫–∞—Ö –∑–∞–ø–∏—Å–∞–Ω–æ –ø–æ –¥–≤–∞ —á–∏—Å–ª–∞ u –∏ v ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–ª–µ—Ç–∫–∏ v –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤
–∫–ª–µ—Ç–∫–µ u (1 ‚©Ω u; v ‚©Ω N, u Ã∏= v).
–í —Å–ª–µ–¥—É—é—â–∏—Ö Q —Å—Ç—Ä–æ–∫–∞—Ö –∑–∞–ø–∏—Å–∞–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π x (0 ‚©Ω x ‚©Ω 109 + 8).
–§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–í –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –≤—ã–≤–µ–¥–∏—Ç–µ Q —Å—Ç—Ä–æ–∫, –≤ –∫–∞–∂–¥–æ–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ –æ–¥–Ω–æ–º—É —á–∏—Å–ª—É ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ-
–ª—É—á–µ–Ω–Ω—ã–π –Ω–∞ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª–µ –¥–ª—è –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è x. –¢–∞–∫ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º,
–≤—ã–≤–µ–¥–∏—Ç–µ –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 109 + 9.
–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
–ë–∞–ª–ª—ã –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–¥–∑–∞–¥–∞—á—É –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è —ç—Ç–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏
–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–¥–∑–∞–¥–∞—á —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
–°—Ç—Ä–∞–Ω–∏—Ü–∞ 5 –∏–∑ 10
I –æ—Ç–±–æ—Ä–æ—á–Ω—ã–π —ç—Ç–∞–ø –í—Å–µ—Å–∏–±–∏—Ä—Å–∫–æ–π –æ—Ç–∫—Ä—ã—Ç–æ–π –æ–ª–∏–º–ø–∏–∞–¥—ã —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ 2020-2021
–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, 18 –æ–∫—Ç—è–±—Ä—è 2020 –≥–æ–¥–∞
–ü–æ–¥–∑–∞–¥–∞—á–∞ –ë–∞–ª–ª—ã –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ
–ø–æ–¥–∑–∞–¥–∞—á–∏
1 23 N;M ‚©Ω 105;Q ‚©Ω 100,
–æ—Ç –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –Ω–µ –±–æ–ª–µ–µ 1 –∫–ª–µ—Ç–∫–∏
2 24 N;M;Q ‚©Ω 105,
–æ—Ç –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –Ω–µ –±–æ–ª–µ–µ 1 –∫–ª–µ—Ç–∫–∏ 1
3 11 N;M;Q ‚©Ω 105, –Ω–µ—Ç –∫–ª–µ—Ç–æ–∫ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º x
4 42 N;M;Q ‚©Ω 105 1, 2, 3

–ü—Ä–∏–º–µ—Ä—ã
input.txt output.txt
3 2 2
+ 3 x
2 1
3 1
2
3
5

6


5 6 1
+ + * x 3
2 1
3 1
4 2
4 3
3 2
5 3
2

14
*/

use std::io;

const DEL: u128 = 1000000009;

fn rec (act: &Vec<(usize, usize)>, moves: &Vec<String>, ind: usize, val: u128) -> u128 {
    return unsafe {
        match moves.get_unchecked(ind).as_str() {
            "x" => val,

            "+" => (rec(act, moves, act.get_unchecked(ind).0, val) +
                rec(act, moves, act.get_unchecked(ind).1, val)) % DEL,

            "*" => (rec(act, moves, act.get_unchecked(ind).0, val) *
                rec(act, moves, act.get_unchecked(ind).1, val)) % DEL,

            _ => moves.get_unchecked(ind).trim().parse::<u128>().unwrap(),
        }
    }
}

#[inline]
fn input_str() -> String {
    let mut input = String::new();
    io::stdin().read_line(&mut input).unwrap();
    input
}

fn main() {
    let input = input_str();
    let mut input_it = input.split_ascii_whitespace();

    let n = input_it.next().unwrap().parse::<usize>().unwrap();
    let m = input_it.next().unwrap().parse::<i32>().unwrap();
    let q = input_it.next().unwrap().parse::<i32>().unwrap();

    let moves = input_str().split_ascii_whitespace()
        .map(|x| x.to_string()).collect::<Vec<String>>();

    let mut act = vec![(usize::MAX, usize::MAX); n];

    for _m in 0..m {
        let input = input_str();
        let mut input_it = input.split_ascii_whitespace();

        let f = input_it.next().unwrap().parse::<usize>().unwrap();
        let s = input_it.next().unwrap().parse::<usize>().unwrap();

        unsafe {
            match act.get_unchecked(s - 1).0 {
                usize::MAX => act.get_unchecked_mut(s - 1).0 = f - 1,
                _ => act.get_unchecked_mut(s - 1).1 = f - 1,
            }
        }
    }

    if let 0 = q {
        println!("{}", rec(&act, &moves, 0, 0));
    } else {
        for _q in 0..q {
            println!("{}", rec(&act, &moves, 0, input_str().trim().parse::<u128>().unwrap()));
        }
    }
}
